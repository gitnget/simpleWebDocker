<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Student List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/auth.js"></script>
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <h1 class="mb-4">Student List</h1>

      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="table-dark">
            <tr id="headerRow"></tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div id="loading" class="text-muted">Loading data...</div>
    </div>

    <!-- Bootstrap JS (optional, for interactive features) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      async function loadStudents() {
        try {
          const response = await fetch("https://fastapi-service-101554626321.asia-southeast1.run.app/getallstudent");
          if (!response.ok) throw new Error("Network response was not ok");

          const data = await response.json();
          document.getElementById("loading").style.display = "none";

          if (!Array.isArray(data) || data.length === 0) {
            document.getElementById("tableBody").innerHTML = "<tr><td colspan='100%' class='text-center text-muted'>No data found</td></tr>";
            return;
          }

          // Generate table headers
          const headerRow = document.getElementById("headerRow");
          Object.keys(data[0]).forEach((key) => {
            const th = document.createElement("th");
            th.textContent = key;
            headerRow.appendChild(th);
          });

          // Generate table rows
          const tableBody = document.getElementById("tableBody");
          data.forEach((row) => {
            const tr = document.createElement("tr");
            Object.values(row).forEach((value) => {
              const td = document.createElement("td");
              td.textContent = value;
              tr.appendChild(td);
            });
            tableBody.appendChild(tr);
          });
        } catch (error) {
          console.error("Error loading students:", error);
          document.getElementById("loading").textContent = "Error loading data";
        }
      }

      loadStudents();
    </script>

    <!-- Shared footer -->
    <div id="footer-placeholder"></div>

    <script src="/js/script.js"></script>
    <script>
      fetch("/header.html")
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("header-placeholder").innerHTML = data;
        });
    </script>
  </body>
</html>
